---
- tgt:
  commands:
  - set pipes in JSON stdin out JSON stdout
  - [ run, producer, pipes, program, sh, "-c", "echo '{\"label\":123}'" ]
  - wait_data label
  - rename label new_name
  - wait_data new_name
  - ruby: userout $lackey.data.keys.sort.join(' ')
  - ruby: $handlers.set_error('Not found.') unless $lackey.data.has_key? 'new_name'
  - delete new_name
  - run delay program sleep 1
  - ruby: userout $lackey.data.keys.sort.join(' ')
  - ruby: $handlers.set_error('Found.') if $lackey.data.has_key? 'new_name'
